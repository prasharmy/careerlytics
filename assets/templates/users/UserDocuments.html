{% extends 'users/user_tailwind_base.html' %}
{% load static %}

{% block contents %}
<div class="flex-1 flex flex-col md:flex-row overflow-hidden h-[calc(100vh-64px)] md:h-full">
    <!-- Document List Panel -->
    <div id="listPanel" class="w-full md:w-1/3 border-r border-slate-200 dark:border-gray-600 bg-white dark:bg-gray-800 flex flex-col overflow-hidden transition-all duration-300">
        <div class="p-6 border-b border-slate-100 dark:border-gray-600 flex-shrink-0">
            <h2 class="text-xl font-black text-[#0f172a] dark:text-white tracking-tight">Available Assets</h2>
            <p class="text-slate-400 dark:text-slate-300 text-xs font-medium mt-1">Select a document to view details.</p>
            <div class="mt-4 relative">
                <span class="material-symbols-outlined absolute left-3 top-2.5 text-slate-400 dark:text-slate-300 text-sm">search</span>
                <input id="searchInput" class="w-full pl-9 pr-4 py-2 bg-slate-50 dark:bg-gray-700 border-slate-200 dark:border-gray-600 rounded-lg text-sm text-slate-700 dark:text-slate-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Search documents..." type="text"/>
            </div>
        </div>
        <div class="flex-1 overflow-y-auto custom-scrollbar">
            <div id="documentList" class="divide-y divide-slate-50 dark:divide-gray-700">
                {% for d in docs %}
                <div class="document-item p-5 hover:bg-slate-50 dark:hover:bg-gray-700 cursor-pointer transition-colors" id="doc-{{ d.id }}" data-doc-id="{{ d.id }}" data-doc-title="{{ d.title }}" data-doc-date="{{ d.uploaded_at|date:'M. d, Y, h:i a' }}" data-file-name="{{ d.original_filename|default:'document.pdf' }}" data-file-size="{{ d.filesize|filesizeformat|default:'1.24 MB' }}" data-security-hash="{{ d.merkle_root|default:'0x7a2f89e'|slice:':10' }}...{{ d.merkle_root|default:'0x7a2f89e'|slice:'-4:' }}" data-uploader="Admin_System" data-retention="Indefinite">
                    <div class="flex justify-between items-start mb-1">
                        <h3 class="font-bold text-sm text-slate-800 dark:text-slate-200 truncate pr-4">{{ d.title }}</h3>
                        <span class="text-[10px] font-bold text-slate-400 dark:text-slate-500">{{ d.uploaded_at|date:"M. d" }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="px-2 py-0.5 rounded-md bg-blue-50 dark:bg-blue-900/30 text-[9px] font-black text-blue-600 dark:text-blue-400 uppercase tracking-tighter">PDF</div>
                        <span class="text-[10px] text-slate-400 dark:text-slate-500 font-medium">ID: {{ d.id }}</span>
                    </div>
                </div>
                {% empty %}
                <div class="p-8 text-center">
                    <span class="material-symbols-outlined text-4xl text-slate-200 dark:text-gray-600">description</span>
                    <p class="mt-2 text-sm text-slate-400 dark:text-slate-500 font-medium">No documents found.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Document Details Panel -->
    <div id="detailsPanel" class="hidden md:flex flex-1 bg-slate-50 dark:bg-gray-900 flex flex-col overflow-hidden relative">
        <!-- Back button for mobile -->
        <button id="backToList" class="md:hidden absolute top-4 left-4 z-20 p-2 bg-white dark:bg-gray-800 rounded-full shadow-md border border-slate-200 dark:border-gray-700 flex items-center justify-center">
            <span class="material-symbols-outlined text-slate-600 dark:text-slate-300">arrow_back</span>
        </button>

        <div id="noSelection" class="absolute inset-0 flex flex-col items-center justify-center p-12 text-center bg-slate-50 dark:bg-gray-900 z-10 transition-all duration-300">
            <div class="w-24 h-24 bg-white dark:bg-gray-800 rounded-2xl shadow-sm flex items-center justify-center mb-6">
                <span class="material-symbols-outlined text-4xl text-slate-200 dark:text-gray-600">article</span>
            </div>
            <h3 class="text-lg font-black text-[#0f172a] dark:text-white tracking-tight">Enterprise Asset Viewer</h3>
            <p class="text-slate-400 dark:text-slate-300 text-sm max-w-xs mt-2 leading-relaxed">Select a secure document from the repository to initialize high-resolution verification protocols.</p>
        </div>

        <div id="docDetails" class="hidden flex-1 flex flex-col overflow-hidden animate-in fade-in duration-300">
            <div class="p-6 md:p-8 border-b border-slate-200 dark:border-gray-600 bg-white dark:bg-gray-800 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-5">
                    <div class="w-14 h-14 bg-blue-50 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center text-blue-600 dark:text-blue-400 shadow-sm border border-blue-100 dark:border-blue-800">
                        <span class="material-symbols-outlined text-3xl">picture_as_pdf</span>
                    </div>
                    <div>
                        <h2 id="detailTitle" class="text-xl md:text-2xl font-black text-[#0f172a] dark:text-white tracking-tighter leading-none mb-2"></h2>
                        <p id="detailDate" class="text-[10px] font-extrabold uppercase tracking-widest text-slate-400 dark:text-slate-500"></p>
                    </div>
                </div>
                <div class="flex gap-3 w-full sm:w-auto">
                    <a id="downloadBtn" href="#" class="flex-1 sm:flex-none flex items-center justify-center gap-2 px-5 py-2.5 bg-[#0f172a] dark:bg-blue-600 hover:bg-slate-800 dark:hover:bg-blue-700 text-white font-bold rounded-xl transition-all shadow-md active:scale-95 text-decoration-none">
                        <span class="material-symbols-outlined text-xl">download</span>
                        <span class="text-sm">Download Asset</span>
                    </a>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-6 md:p-8 custom-scrollbar">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-600 rounded-2xl overflow-hidden shadow-sm">
                            <div class="p-5 border-b border-slate-100 dark:border-gray-600 flex items-center gap-3">
                                <span class="material-symbols-outlined text-blue-600 dark:text-blue-400">verified</span>
                                <span class="text-[10px] font-extrabold uppercase tracking-widest text-slate-900 dark:text-white">Security Verification Metadata</span>
                            </div>
                            <div class="p-6 md:p-8 space-y-8">
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
                                    <div class="space-y-1.5">
                                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Document UUID</p>
                                        <p id="detailId" class="text-xs font-bold text-slate-800 dark:text-slate-200 font-mono"></p>
                                    </div>
                                    <div class="space-y-1.5">
                                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">File Signature (SHA-256)</p>
                                        <p id="detailHash" class="text-xs font-bold text-slate-800 dark:text-slate-200 font-mono truncate"></p>
                                    </div>
                                    <div class="space-y-1.5">
                                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Origin Filename</p>
                                        <p id="detailFileName" class="text-xs font-bold text-slate-800 dark:text-slate-200"></p>
                                    </div>
                                    <div class="space-y-1.5">
                                        <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Archive Size</p>
                                        <p id="detailSize" class="text-xs font-bold text-slate-800 dark:text-slate-200"></p>
                                    </div>
                                </div>
                                <div class="p-6 bg-slate-50 dark:bg-gray-700/50 rounded-xl border border-slate-100 dark:border-gray-600">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                                        <p class="text-[10px] font-bold uppercase text-slate-800 dark:text-white tracking-widest">Authentication Status</p>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-300 leading-relaxed font-medium">This document has been cryptographically signed and stored in our secure enterprise repository. Integrity verification completed at <span id="verificationTimestamp" class="text-blue-600 dark:text-blue-400 font-bold"></span>.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-600 rounded-2xl overflow-hidden shadow-sm">
                            <div class="p-5 border-b border-slate-100 dark:border-gray-600 flex items-center gap-3">
                                <span class="material-symbols-outlined text-blue-600 dark:text-blue-400">info</span>
                                <span class="text-[10px] font-extrabold uppercase tracking-widest text-slate-900 dark:text-white">Audit Information</span>
                            </div>
                            <div class="p-6 space-y-6">
                                <div class="space-y-1.5">
                                    <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Authorizing Agent</p>
                                    <p id="detailUploader" class="text-xs font-bold text-slate-800 dark:text-slate-200"></p>
                                </div>
                                <div class="space-y-1.5">
                                    <p class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 dark:text-slate-500">Retention Policy</p>
                                    <p id="detailRetention" class="text-xs font-bold text-slate-800 dark:text-slate-200"></p>
                                </div>
                                <hr class="border-slate-100 dark:border-gray-700">
                                <div class="flex items-center justify-between">
                                    <span class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase">Accessibility</span>
                                    <span class="px-2 py-0.5 bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-[9px] font-black uppercase rounded">Global</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style type="text/tailwindcss">
    .enterprise-card {
        background: #ffffff;
        border: 1px solid #e2e8f0;
    }
    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
    }
    .document-item.active {
        background-color: #eff6ff;
        border-left: 4px solid #2563eb;
    }
    .dark .document-item.active {
        background-color: #1e293b;
        border-left: 4px solid #3b82f6;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const documentItems = document.querySelectorAll('.document-item');
        const noSelection = document.getElementById('noSelection');
        const docDetails = document.getElementById('docDetails');
        const searchInput = document.getElementById('searchInput');
        const listPanel = document.getElementById('listPanel');
        const detailsPanel = document.getElementById('detailsPanel');
        const backToList = document.getElementById('backToList');
        
        // Element IDs for details
        const elements = {
            title: document.getElementById('detailTitle'),
            date: document.getElementById('detailDate'),
            id: document.getElementById('detailId'),
            hash: document.getElementById('detailHash'),
            fileName: document.getElementById('detailFileName'),
            size: document.getElementById('detailSize'),
            uploader: document.getElementById('detailUploader'),
            retention: document.getElementById('detailRetention'),
            downloadBtn: document.getElementById('downloadBtn'),
            timestamp: document.getElementById('verificationTimestamp')
        };

        documentItems.forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all items
                documentItems.forEach(i => i.classList.remove('active'));
                // Add active class to clicked item
                this.classList.add('active');

                // Update details
                const data = this.dataset;
                elements.title.textContent = data.docTitle;
                elements.date.textContent = `PUBLISHED: ${data.docDate}`;
                elements.id.textContent = `ASSET-SEC-${data.docId}`;
                elements.hash.textContent = data.securityHash;
                elements.fileName.textContent = data.fileName;
                elements.size.textContent = data.fileSize;
                elements.uploader.textContent = data.uploader;
                elements.retention.textContent = data.retention;
                elements.downloadBtn.href = `/download-doc/${data.docId}/`;
                elements.timestamp.textContent = new Date().toLocaleString();

                // Show details panel
                noSelection.classList.add('hidden');
                docDetails.classList.remove('hidden');

                // Mobile panel switching
                if (window.innerWidth < 768) {
                    listPanel.classList.add('hidden');
                    detailsPanel.classList.remove('hidden');
                    detailsPanel.classList.add('flex');
                }
            });
        });

        // Back button functionality for mobile
        if (backToList) {
            backToList.addEventListener('click', function() {
                listPanel.classList.remove('hidden');
                detailsPanel.classList.add('hidden');
                detailsPanel.classList.remove('flex');
            });
        }

        // Search functionality
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            documentItems.forEach(item => {
                const title = item.dataset.docTitle.toLowerCase();
                if (title.includes(query)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });

        // Reset view on window resize
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768) {
                listPanel.classList.remove('hidden');
                detailsPanel.classList.remove('hidden');
                detailsPanel.classList.add('flex');
            } else {
                if (docDetails.classList.contains('hidden')) {
                    listPanel.classList.remove('hidden');
                    detailsPanel.classList.add('hidden');
                } else {
                    listPanel.classList.add('hidden');
                    detailsPanel.classList.remove('hidden');
                }
            }
        });
    });
</script>
{% endblock %}
