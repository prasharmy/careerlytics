{% extends 'users/user_tailwind_base.html' %}
{% load static %}

{% block title %}Apply for {{ drive.company_name }} - Careerlytics{% endblock %}
{% block page_title %}Apply for Drive{% endblock %}

{% block contents %}
<div class="min-h-screen bg-slate-50 dark:bg-gray-900 py-12 px-4 sm:px-6 lg:px-8 transition-colors duration-500">
    <div class="max-w-5xl mx-auto">
        <!-- Back Navigation -->
        <div class="mb-10 animate-fade-in">
            <a href="{% url 'users:campus_drives' %}" class="inline-flex items-center gap-2 group text-slate-500 hover:text-brand-blue dark:text-slate-400 dark:hover:text-blue-400 font-bold text-sm transition-all">
                <div class="w-8 h-8 rounded-full bg-white dark:bg-white/5 shadow-sm border border-slate-200 dark:border-white/10 flex items-center justify-center group-hover:scale-110 group-hover:bg-brand-blue group-hover:text-white transition-all">
                    <span class="material-symbols-outlined text-lg">arrow_back</span>
                </div>
                Return to Career Portal
            </a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Left Column: Drive Info Card -->
            <div class="lg:col-span-5 space-y-6 animate-fade-in" style="animation-delay: 100ms">
                <div class="relative group">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-brand-blue to-indigo-600 rounded-3xl blur opacity-10 group-hover:opacity-20 transition duration-1000"></div>
                    <div class="relative bg-white dark:bg-gray-800 border border-slate-200 dark:border-gray-600 rounded-3xl p-8 shadow-xl overflow-hidden">
                        <!-- Branding -->
                        <div class="flex items-center gap-4 mb-8">
                            <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-brand-blue/10 to-indigo-500/10 flex items-center justify-center text-brand-blue border border-brand-blue/10">
                                <span class="material-symbols-outlined text-4xl">business</span>
                            </div>
                            <div>
                                <h3 class="text-[10px] font-black text-brand-blue uppercase tracking-[0.2em] mb-1">Company Profile</h3>
                                <h1 class="text-2xl font-black text-slate-900 dark:text-white tracking-tight">{{ drive.company_name }}</h1>
                            </div>
                        </div>

                        <!-- Info Grid -->
                        <div class="space-y-6">
                            <div class="flex items-start gap-4 p-4 rounded-2xl bg-slate-50 dark:bg-gray-700 border border-slate-100 dark:border-gray-600">
                                <div class="w-10 h-10 rounded-xl bg-white dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-slate-400 shadow-sm">
                                    <span class="material-symbols-outlined text-xl">work</span>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5">Role / Position</p>
                                    <p class="text-sm font-black text-slate-900 dark:text-white">{{ drive.title }}</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-4 p-4 rounded-2xl bg-slate-50 dark:bg-gray-700 border border-slate-100 dark:border-gray-600">
                                <div class="w-10 h-10 rounded-xl bg-white dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-slate-400 shadow-sm">
                                    <span class="material-symbols-outlined text-xl">calendar_today</span>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5">Application Date</p>
                                    <p class="text-sm font-black text-slate-900 dark:text-white">{{ drive.date|date:"F d, Y" }}</p>
                                </div>
                            </div>

                            <div class="flex items-start gap-4 p-4 rounded-2xl bg-slate-50 dark:bg-gray-700 border border-slate-100 dark:border-gray-600">
                                <div class="w-10 h-10 rounded-xl bg-white dark:bg-white/10 flex items-center justify-center text-slate-600 dark:text-slate-400 shadow-sm">
                                    <span class="material-symbols-outlined text-xl">location_on</span>
                                </div>
                                <div>
                                    <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5">Location</p>
                                    <p class="text-sm font-black text-slate-900 dark:text-white">{{ drive.location }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Important Note -->
                        <div class="mt-8 p-5 rounded-2xl bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 rounded-lg bg-amber-500 text-white flex items-center justify-center">
                                    <span class="material-symbols-outlined text-lg">info</span>
                                </div>
                                <h4 class="text-xs font-black text-amber-800 dark:text-amber-400 uppercase tracking-wider">Pre-submission Check</h4>
                            </div>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2 text-[11px] font-bold text-amber-700 dark:text-amber-300/80">
                                    <span class="text-amber-500 mt-0.5">●</span> Verify CGPA & Branch details match official records.
                                </li>
                                <li class="flex items-start gap-2 text-[11px] font-bold text-amber-700 dark:text-amber-300/80">
                                    <span class="text-amber-500 mt-0.5">●</span> Ensure your registered Gmail is active for updates.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Form Section -->
            <div class="lg:col-span-7 animate-fade-in" style="animation-delay: 200ms">
                <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-slate-200 dark:border-gray-600 rounded-3xl shadow-2xl overflow-hidden">
                    <div class="p-8 md:p-10">
                        <div class="mb-10">
                            <h2 class="text-2xl font-black text-slate-900 dark:text-white tracking-tight">Application Portal</h2>
                            <p class="text-sm text-slate-500 font-medium mt-1">Please provide your academic and contact details below.</p>
                        </div>

                        {% if messages %}
                        <div class="space-y-4 mb-8">
                            {% for message in messages %}
                            <div class="p-4 rounded-2xl flex items-center gap-3 border animate-fade-in
                                {% if message.tags == 'error' %}
                                    bg-red-50 border-red-200 text-red-700 dark:bg-red-900/20 dark:border-red-800/50 dark:text-red-400
                                {% elif message.tags == 'success' %}
                                    bg-emerald-50 border-emerald-200 text-emerald-700 dark:bg-emerald-900/20 dark:border-emerald-800/50 dark:text-emerald-400
                                {% else %}
                                    bg-brand-blue/5 border-brand-blue/20 text-brand-blue dark:bg-brand-blue/10 dark:text-blue-400
                                {% endif %}">
                                <span class="material-symbols-outlined">
                                    {% if message.tags == 'error' %}error{% elif message.tags == 'success' %}check_circle{% else %}info{% endif %}
                                </span>
                                <p class="text-xs font-black uppercase tracking-wider">{{ message }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        {% if applied_successfully %}
                        <div class="text-center py-12 px-6">
                            <div class="relative inline-block mb-8">
                                <div class="absolute -inset-4 bg-emerald-500/20 rounded-full blur-xl animate-pulse"></div>
                                <div class="relative w-24 h-24 bg-emerald-500 text-white rounded-full flex items-center justify-center shadow-lg shadow-emerald-500/40">
                                    <span class="material-symbols-outlined text-6xl">verified</span>
                                </div>
                            </div>
                            <h3 class="text-3xl font-black text-slate-900 dark:text-white mb-3 tracking-tight">Success!</h3>
                            <p class="text-slate-500 dark:text-slate-400 font-medium mb-10 max-w-sm mx-auto">
                                Your application for <span class="text-slate-900 dark:text-white font-black">{{ drive.company_name }}</span> has been submitted successfully.
                            </p>
                            <a href="{% url 'users:campus_drives' %}" class="inline-flex items-center justify-center gap-2 w-full sm:w-auto bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-4 rounded-2xl font-black text-sm hover:opacity-90 transition-all shadow-xl dark:shadow-white/5">
                                Explore More Opportunities
                                <span class="material-symbols-outlined">arrow_forward</span>
                            </a>
                        </div>
                        {% else %}
                        <form method="post" class="space-y-8">
                            {% csrf_token %}
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Full Name -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Full Legal Name</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">person</span>
                                        </div>
                                        <input type="text" name="{{ form.full_name.name }}" value="{{ form.full_name.value|default:'' }}" 
                                               placeholder="John Doe" required
                                               class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all">
                                    </div>
                                    {% if form.full_name.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.full_name.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Hall Ticket -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Hall Ticket Number</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">badge</span>
                                        </div>
                                        <input type="text" name="{{ form.hall_ticket_number.name }}" value="{{ form.hall_ticket_number.value|default:'' }}" 
                                               placeholder="HTN123456" required
                                               class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all">
                                    </div>
                                    {% if form.hall_ticket_number.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.hall_ticket_number.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Gmail -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Email Address</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">mail</span>
                                        </div>
                                        <input type="email" name="{{ form.gmail.name }}" value="{{ form.gmail.value|default:'' }}" 
                                               placeholder="john@gmail.com" required
                                               class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all">
                                    </div>
                                    {% if form.gmail.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.gmail.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Phone -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Contact Number</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">call</span>
                                        </div>
                                        <input type="tel" name="{{ form.phone_number.name }}" value="{{ form.phone_number.value|default:'' }}" 
                                               placeholder="+91 00000 00000" required
                                               class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all">
                                    </div>
                                    {% if form.phone_number.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.phone_number.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Branch -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Branch / Department</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">account_tree</span>
                                        </div>
                                        <select name="{{ form.branch.name }}" required
                                                class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all appearance-none">
                                            <option value="">Select Branch</option>
                                            <option value="B.Tech CSE" {% if form.branch.value == "B.Tech CSE" or user.branch == "B.Tech CSE" %}selected{% endif %}>B.Tech CSE</option>
                                            <option value="B.Tech ECE" {% if form.branch.value == "B.Tech ECE" or user.branch == "B.Tech ECE" %}selected{% endif %}>B.Tech ECE</option>
                                            <option value="B.Tech EEE" {% if form.branch.value == "B.Tech EEE" or user.branch == "B.Tech EEE" %}selected{% endif %}>B.Tech EEE</option>
                                            <option value="B.Tech MECH" {% if form.branch.value == "B.Tech MECH" or user.branch == "B.Tech MECH" %}selected{% endif %}>B.Tech MECH</option>
                                            <option value="B.Tech CIVIL" {% if form.branch.value == "B.Tech CIVIL" or user.branch == "B.Tech CIVIL" %}selected{% endif %}>B.Tech CIVIL</option>
                                            <option value="B.Tech IT" {% if form.branch.value == "B.Tech IT" or user.branch == "B.Tech IT" %}selected{% endif %}>B.Tech IT</option>
                                            <option value="BCA" {% if form.branch.value == "BCA" or user.branch == "BCA" %}selected{% endif %}>BCA</option>
                                            <option value="MCA" {% if form.branch.value == "MCA" or user.branch == "MCA" %}selected{% endif %}>MCA</option>
                                            <option value="M.Sc Computer Science" {% if form.branch.value == "M.Sc Computer Science" or user.branch == "M.Sc Computer Science" %}selected{% endif %}>M.Sc Computer Science</option>
                                            <option value="Other" {% if form.branch.value == "Other" or user.branch == "Other" %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                    {% if form.branch.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.branch.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- CGPA -->
                                <div class="space-y-2">
                                    <label class="block text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] ml-1">Current CGPA / %</label>
                                    <div class="relative group/input">
                                        <div class="absolute inset-y-0 left-4 flex items-center text-slate-400 group-focus-within/input:text-brand-blue transition-colors">
                                            <span class="material-symbols-outlined text-lg">analytics</span>
                                        </div>
                                        <input type="number" step="0.01" name="{{ form.percentage_cgpa.name }}" value="{{ form.percentage_cgpa.value|default:'' }}" 
                                               placeholder="8.50" required
                                               class="w-full bg-slate-50 dark:bg-gray-700 border border-slate-200 dark:border-gray-600 rounded-2xl pl-12 pr-4 py-4 text-sm font-bold text-slate-900 dark:text-white focus:outline-none focus:ring-4 focus:ring-brand-blue/10 focus:border-brand-blue transition-all">
                                    </div>
                                    {% if form.percentage_cgpa.errors %}
                                        <p class="text-[10px] font-bold text-red-500 ml-1">{{ form.percentage_cgpa.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Footer Actions -->
                            <div class="flex flex-col sm:flex-row items-center gap-4 pt-10 border-t border-slate-200 dark:border-gray-600">
                                <a href="{% url 'users:campus_drives' %}" class="w-full sm:w-auto px-8 py-4 text-sm font-black text-slate-500 hover:text-slate-900 dark:hover:text-white transition-all uppercase tracking-widest text-center">
                                    Cancel
                                </a>
                                <button type="submit" class="w-full flex-1 bg-blue-600 text-white px-8 py-4 rounded-2xl font-black text-sm shadow-xl shadow-blue-600/20 flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-lg">rocket_launch</span>
                                    SUBMIT REGISTRATION
                                </button>
                            </div>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fade-in {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fade-in 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
    }
</style>
{% endblock %}
